---
layout: page
title: 顔トラッキング
---

# 顔トラッキング
{: .no_toc }

`VMagicMirror` v4.0.0以降では「顔トラッキング」タブから顔トラッキングの種類を選択し、基本的なセットアップを行うことができます。

<div class="row">
{% include docimg.html file="/images/docs/face_tracker_top.png" customclass="col s12 m6 l6" imgclass="fit-doc-img" %}
</div>

<div class="toc-area" markdown="1">

#### 目次
{: .toc-header .no_toc }

* ToC
{:toc .table-of-contents }

</div>


### サポートしている顔トラッキングの種類
{: .doc-sec1 }

`VMagicMirror` では顔トラッキングとして下記のトラッキング方法をサポートしています。

<div class="doc-ul" markdown="1">

- `webカメラ (軽量)`: PCに接続したwebカメラによる顔トラッキングです。精度や反応速度が抑えめな変わり、PCへの負荷が軽量になります。
- `webカメラ (高品質)`: PCに接続したwebカメラによる顔トラッキングです。PCの負荷が上昇するかわりに、反応速度が改善したり、より詳細な表情検出が行えたりします。
- `外部トラッキング`: iOSアプリであるiFacialMocapと連携する顔トラッキングです。iFacialMocapが利用できる場合、PC負荷を大幅に抑えつつ、高精度な顔トラッキングが利用できます。

</div>

また、webカメラによる顔トラッキングを選択したうえでカメラをオフにすると、画像によるトラッキングは行わない状態になります。PC負荷を非常に小さくしたい場合、この状態でもVMagicMirrorを使用できます。

<div class="note-area" markdown="1">

**NOTE**

上記に加えて [VMC Protocol](../vmc_protocol) での受信データもトラッキング情報として適用できます。ただし、この方法を用いるには高度なセットアップが必要です。詳細は [VMC Protocol](../vmc_protocol) を参照して下さい。

</div>


### 顔トラッキングの種類ごとに利用できる設定
{: .doc-sec1 }

ここでは顔トラッキングの種類に応じた動作や、利用可能なオプションを説明します。

共通の機能として、どのトラッキングを用いている場合も `現在位置で顔をキャリブレーション` ボタンによってカメラとユーザーの位置関係をチェックし、アバター姿勢を補正できます。

なお、アバターの顔の動作についてはここで挙げたオプション以外で、詳細設定ウィンドウの [顔・表情](../face) にも利用可能なオプションがあります。


#### webカメラ(軽量)
{: .doc-sec2 }

`webカメラ (軽量)` はPC負荷を極力抑えてwebカメラを利用したい場合のためのオプションです。ゲーム中のトラッキングなど、VMagicMirrorによるCPU/GPU負荷を小さくしたい場合はこのオプションを使用します。

<div class="row">
{% include docimg.html file="/images/docs/face_tracker_webcam_lite.jpg" customclass="col s12 m6 l6" imgclass="fit-doc-img" %}
</div>


`webカメラ (軽量)` の使用中は、まばたきのトラッキング情報は使用されず、マイク入力や頭部の動作に基づいてアバターに瞬きが適用されます。また、口元の動作(リップシンク)はマイク入力に基づいて適用されます。そのほか、後述する表情スイッチ機能は本オプションの適用中には動作できません。

下記の設定をサポートしています。

<div class="doc-ul" markdown="1">

- `webカメラをオン`: チェックをオンにするとwebカメラによるトラッキングを開始します。PC負荷を極力抑えたい場合、オフにしておくことでカメラの使用を停止します。
- `左右反転をオフにする`: チェックをオンにすると、左右が反転していない状態でトラッキング結果が適用されます。
- `視線の動き`: 視線をどう動かすか選択します。`マウス` を選択すると、アバターがマウスポインターの方向を見ようとします。`固定`ではマウスを無視します。`ユーザー` は `固定` に似ていますが、`フリーカメラモード` でアバターの向きを正面向き以外にしたときに、なるべくモニターの正面方向を見ようとします。

</div>


#### webカメラ(高品質)
{: .doc-sec2 }

`webカメラ(高品質)` では、PC負荷が上昇するかわりに高精度なトラッキングを行います。PCスペックに余裕がある場合や、VMagicMirrorのみが高負荷なアプリケーションになるようなケースでは、場合にこのオプションを使用できます。

<div class="row">
{% include docimg.html file="/images/docs/face_tracker_webcam_high_power.jpg" customclass="col s12 m6 l6" imgclass="fit-doc-img" %}
</div>

このオプションでは `webカメラ(軽量)` と異なり、まばたきや口元の動作についてもカメラで取得したデータが適用されます。

設定項目では、下記の項目をサポートしています。

<div class="doc-ul" markdown="1">

- `webカメラをオン`: チェックをオンにするとwebカメラによるトラッキングを開始します。PC負荷を極力抑えたい場合、オフにしておくことでカメラの使用を停止します。
- `左右反転をオフにする`: チェックをオンにすると、左右が反転していない状態でトラッキング結果が適用されます。
- `手前・奥への移動を有効化`: チェックをオンにすると、手前や奥方向にもアバターが移動します(※)。
- `カメラで検出したリップシンクを適用`: チェックをオンにすると、アバターの口の動作がカメラによるトラッキングに基づいた動作になります。チェックがオフの場合、マイクで検出した音声によるリップシンクが適用されます。
- `パーフェクトシンクを使用`: 表示中のアバターがパーフェクトシンク用のブレンドシェイプに対応している場合、パーフェクトシンクが適用されます。モデルの必要なセットアップ等については [パーフェクトシンク](../../tips/perfect_sync) を参照して下さい。
- `視線の動き`: `webカメラ (軽量)` にあるのと同様のオプションです。`webカメラ(高品質)` の場合、このオプションはカメラをオフにしている間だけ選択できます。

</div>

※`手前・奥への移動を有効化` については、キーボードやゲームパッドを操作する挙動が有効な場合、モーションの破綻を減らすために前後への移動量が制限されます。アバターを前後へ大きく移動させたい場合、`配信`タブ > `モーション` > `動きかた` で、`つねに手下げ` を選択してください。

とくに、まばたきの動作設定について `まばたきのトラッキング設定を開く` から、調整用のウィンドウを開いて詳細設定を行えます。

<div class="row">
{% include docimg.html file="/images/docs/face_tracker_eye_calibration_window.jpg" customclass="col s12 m6 l6" imgclass="fit-doc-img" %}
</div>


このウィンドウでは `webカメラ(高品質)` を選択しているときの目のトラッキングについて、「まばたき値」という数値を設定します。

「まばたき値」は目を開いていると小さくなり、目を閉じていると大きくなるような数値で、値は 0% から 100% までの範囲を取ります。実際の値は個人差やwebカメラの配置の影響を受けます。

以下の設定が調整できます。

<div class="doc-ul" markdown="1">

- `目を開けているときのまばたき値 (%)`: 目を完全に開いているときのまばたき値を指定します。0~30程度の値が目安です。
- `目を閉じているときのまばたき値 (%)`: 目を完全に閉じているときのまばたき値を指定します。40~70程度の値が目安です。
- `左右のまばたき値の平均を使う`: チェックをオンにすると、左右のまばたきの平均を両目に適用します。アバターの目の動きが左右でずれてしまう場合、オンにすると見た目が安定します。ただし、オンにすると片目を閉じるウインク等の動作は適用されなくなります。
- `パーフェクトシンクのまばたきにも補正を適用`: チェックをオンにすると、パーフェクトシンクの利用中も本ウィンドウでの設定による補正が適用されます。パーフェクトシンク中にアバターの目が半目になりやすい場合、オンにしておきます。
- `まばたき値のプレビューを表示`: チェックをオンにすると、実際に検出している左右の目のまばたき値と、最大/最小値の範囲が表示されます。
  - `プレビュー表示をリセット` ボタンを押すと、最大値/最小値の履歴がリセットされます。

</div>

とくに `まばたき値のプレビューを表示` をオンにすることで、実際に検出されているまばたき値を確認できます。以下のポイントを踏まえると、意図したまばたきが適用しやすくなります。

<div class="doc-ul" markdown="1">

- `目を開けているときのまばたき値 (%)` には、プレビューでチェックした最小値より大きい値を指定します。
- `目を閉じているときのまばたき値 (%)` には、プレビューでチェックした最大値より小さい値を指定します。
- 上記の2つの値を近い値にすると半目の状態を検出しにくくなり、目の開閉がはっきりと分かれます。

</div>

セットアップの数値の例として、下記のスクリーンショットでは `Min`が5~10程度であり、`Max`は70~80程度の数値になっています。

<div class="row">
{% include docimg.html file="/images/docs/face_tracker_eye_calibration_example.png" customclass="col s12 m6 l4" imgclass="fit-doc-img" %}
</div>

このようなプレビュー結果に対して、例えば次のようなセットアップが有効です。

<div class="doc-ul" markdown="1">

- 半目もアバターに反映できるようにしたい場合
    - `目を開けているときのまばたき値 (%)`: 20
    - `目を閉じているときのまばたき値 (%)`: 60
- 半目にならないようにしたい場合
    - `目を開けているときのまばたき値 (%)`: 35
    - `目を閉じているときのまばたき値 (%)`: 40

</div>



#### 外部トラッキング
{: .doc-sec2 }

外部トラッキング機能は、iOSアプリである　[iFacialMocap](https://apps.apple.com/jp/app/ifacialmocap/id1489470545) と連携するオプションです。

iFacialMocapアプリの利用環境が手元にある場合、このオプションではPC負荷を抑えつつ高精度な顔トラッキングを適用できます。

外部トラッキングによるトラッキングの詳細については、 [外部トラッキング](../external_tracker) ページ、および [iFacialMocapとの連携](../external_tracker_ifacialmocap) を参照して下さい。


### 表情スイッチ機能を使う
{: .doc-sec1 }

表情スイッチ機能は、ユーザーの特定の表情を検出してアバターの表情を切り替える機能です。

<div class="row">
{% include docimg.html file="./images/docs/ex_tracker_50_face_switch.png" customclass="col l6 m6 s12" imgclass="fit-doc-img" %}
</div>

この機能は、顔トラッキングとして `webカメラ (高品質)` または `外部トラッキング` を使っている場合に利用できます。ただし、`webカメラ (高品質)` では一部の表情は検出されません。


表情スイッチ機能のセットアップでは3つのパラメータを指定します。

<div class="doc-ul" markdown="1">

- `しきい値`: どの程度その表情を明確にすると表情が切り替わるかを指定します。
- `表情`: 適用するブレンドシェイプ名を指定します。何も適用したくなければ、`(何もしない)`を指定します。
- `リップシンクを続行`: 表情を切り替えたままリップシンクを動かし続けます。目だけが切り替わるブレンドシェイプに対して適用してください。

</div>

個人差や表情のタイプによっては反応しにくいものもあることに注意してください。

なお、この機能は顔トラッキングの延長であるほか、ユーザーの表情を一種のショートカットキーとして使える機能でもあります。

たとえば「舌を出したら悲しい表情になる」など、見た目上は対応関係がないような割り当ても活用できます。

<div class="note-area" markdown="1">

**NOTE**

`Word to Motion`機能による表情切り替えと表情スイッチを同時に使用すると、`Word to Motion`機能による表情が優先して適用されます。

</div>

上記のほか、表情スイッチによってアクセサリーを表示することができます。

`アクセサリーオプションを表示`チェックをオンにすると、それぞれの条件で表示したいアクセサリーを選択できるようになります。

アクセサリー機能の詳細については[アクセサリー](../accessory)ページから確認できます。
